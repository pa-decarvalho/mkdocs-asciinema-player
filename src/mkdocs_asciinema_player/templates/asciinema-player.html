{% include "themes/" ~ mkap_theme ~ ".html" %}
<script>
    (function() {
        var targetId = "{{ 'asciinema-player-' ~ match_id }}";

        function initPlayer() {
            var element = document.getElementById(targetId);

            if (element && !element.hasAttribute('data-mkap-initialized')) {
                element.setAttribute('data-mkap-initialized', 'true');

                AsciinemaPlayer.create("{{ file_path }}", element, {
                    cols: {{ cols }},
                    rows: {{ rows }},
                    autoPlay: {{ auto_play | string | lower }},
                    preload: {{ preload | string | lower }},
                    loop: {{ loop | string | lower }},
                    startAt: "{{ start_at }}",
                    speed: {{ speed }},
                    theme: "{{ theme }}",
                    fit: "{{ fit }}",
                    controls: "{{ controls }}",
                    pauseOnMarkers: {{ pause_on_markers | string | lower }},
                    terminalFontSize: "{{ terminal_font_size }}",
                    terminalFontFamily: "{{ terminal_font_family }}",
                    terminalLineHeight: {{ terminal_line_height }},
                });
            }
        }

        // 1. Handle MkDocs Material instant loading/navigation
        if (typeof document$ !== "undefined") {
            document$.subscribe(function() {
                initPlayer();
            });
        } 
        
        // 2. Fallback for standard page load (DOM Ready)
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initPlayer);
        } else {
            initPlayer();
        }
    })();
</script>
